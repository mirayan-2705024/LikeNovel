# LikeNovel 使用指南

## 📖 目录

1. [快速开始](#快速开始)
2. [Web界面使用](#web界面使用)
3. [功能详解](#功能详解)
4. [常见问题](#常见问题)
5. [高级用法](#高级用法)

---

## 快速开始

### 第一步：启动服务

**Windows 用户（推荐）：**

1. 确保已安装 Docker Desktop 并启动
2. 双击运行 `start.bat`
3. 等待服务启动（约 10-15 秒）
4. 浏览器会自动打开 http://localhost:5000

**手动启动：**

```bash
# 1. 启动 Neo4j
docker-compose up -d

# 2. 启动 Flask 后端
python backend/app.py

# 3. 在浏览器打开
# http://localhost:5000
```

### 第二步：上传小说

1. 点击"选择文件"按钮
2. 选择一个 TXT 格式的小说文件
3. 点击"上传并分析"按钮
4. 等待分析完成（时间取决于小说长度）

### 第三步：查看分析结果

分析完成后，可以在不同标签页查看：
- 📊 **概览**：统计数据
- 👥 **人物关系**：关系图谱
- ⏱️ **时间线**：事件时间线
- 🗺️ **地点**：地点分析
- 💭 **情感**：情感曲线

---

## Web界面使用

### 界面布局

```
┌─────────────────────────────────────────┐
│         📚 LikeNovel 标题栏              │
├─────────────────────────────────────────┤
│         📤 上传区域                      │
│         [选择文件] [上传并分析]          │
│         已分析的小说: [下拉选择]         │
├─────────────────────────────────────────┤
│  [概览] [人物关系] [时间线] [地点] [情感] │  ← 标签导航
├─────────────────────────────────────────┤
│                                         │
│         内容显示区域                     │
│                                         │
└─────────────────────────────────────────┘
```

### 上传区域

**支持的文件格式：**
- ✅ TXT 文本文件
- ❌ EPUB（计划中）
- ❌ PDF（计划中）

**文件要求：**
- 编码：UTF-8（推荐）或 GBK
- 大小：建议 < 10MB
- 结构：包含章节标题（如"第一章"、"Chapter 1"等）

**上传流程：**
1. 选择文件
2. 点击"上传并分析"
3. 等待上传（显示"正在上传..."）
4. 等待分析（显示"上传成功，开始分析..."）
5. 分析完成（显示统计信息）

### 小说选择

- 已分析的小说会保存在内存中（重启后清空）
- 可以通过下拉菜单切换不同的小说
- 显示格式：`小说名 (章节数, 字数)`

---

## 功能详解

### 1. 概览标签 📊

显示小说的基本统计信息：

- **章节数**：小说总章节数
- **总字数**：小说总字数
- **人物数**：识别出的人物数量
- **关系数**：人物之间的关系数量
- **事件数**：识别出的事件数量
- **地点数**：识别出的地点数量

### 2. 人物关系标签 👥

#### 关系图谱

**图谱说明：**
- 🔴 **红色大节点**：主要人物
- 🔵 **蓝色小节点**：次要人物
- 节点大小：表示人物重要性
- 连线粗细：表示关系强度
- 连线标签：关系类型（朋友、敌人、师徒等）

**交互操作：**
- **点击节点**：查看人物详细信息
- **双击节点**：放大并居中显示
- **拖动节点**：调整图谱布局
- **鼠标滚轮**：缩放图谱
- **拖动空白**：移动整个图谱

**人物详情面板：**
- 基本信息：重要度、出现次数、首次出现章节
- 人物关系：与其他人物的关系列表
- 关系强度：百分比显示

#### 人物列表

右侧面板显示前 10 个人物：
- 人物名称
- 重要度百分比
- 出现次数

点击人物可查看详细信息。

### 3. 时间线标签 ⏱️

#### 事件列表

按章节顺序显示所有事件：
- 事件描述
- 所在章节
- 事件序号
- 重要度评分
- 事件类型
- 参与人物

**事件类型：**
- 🟢 **主线事件**：绿色背景，对主线贡献大
- ⚪ **普通事件**：灰色背景

#### 筛选功能

- **只显示主线事件**：勾选复选框只看重要事件
- **章节筛选**：选择特定章节查看该章节的事件

### 4. 地点标签 🗺️

显示小说中的所有地点：

**地点卡片信息：**
- 地点名称
- 地点类型（城市、山脉、建筑等）
- 重要度百分比
- 发生的事件数量

**地点类型标签：**
- 不同类型用不同颜色标识
- 悬停可查看更多信息

### 5. 情感标签 💭

#### 情感曲线图

- **横轴**：章节编号
- **纵轴**：情感值（-1 到 1）
  - 正值：积极情感
  - 负值：消极情感
  - 0：中性

**图表交互：**
- 悬停查看具体数值
- 可以看到情感的起伏变化

#### 情感统计

- **平均情感值**：整体情感倾向
- **情感波动**：情感变化的剧烈程度
- **情感高峰**：情感高潮点的数量

---

## 常见问题

### Q1: 上传失败怎么办？

**可能原因：**
1. 文件格式不支持（只支持 TXT）
2. 文件编码问题（尝试转换为 UTF-8）
3. 文件过大（建议 < 10MB）
4. 后端服务未启动

**解决方法：**
1. 检查文件格式和编码
2. 确保 Flask 服务正在运行
3. 查看浏览器控制台错误信息

### Q2: 分析时间很长？

**正常情况：**
- 短篇小说（< 10 万字）：10-30 秒
- 中篇小说（10-50 万字）：30-120 秒
- 长篇小说（> 50 万字）：2-5 分钟

**优化建议：**
- 分章节上传
- 使用性能更好的机器
- 等待后续版本的性能优化

### Q3: 图谱显示不全？

**解决方法：**
1. 使用鼠标滚轮缩小视图
2. 拖动图谱查看其他区域
3. 双击节点自动居中
4. 刷新页面重新加载

### Q4: 人物识别不准确？

**原因：**
- NLP 模型的局限性
- 小说中人物名称不规范
- 别名、称呼过多

**改进方向：**
- 后续版本会加入人工校正功能
- 支持自定义人物词典

### Q5: 如何停止服务？

**Windows 用户：**
- 双击运行 `stop.bat`

**手动停止：**
```bash
# 1. 停止 Flask（在运行窗口按 Ctrl+C）
# 2. 停止 Neo4j
docker-compose down
```

### Q6: 重启后数据丢失？

**原因：**
- 当前版本使用内存缓存
- 重启后缓存清空

**解决方法：**
- 数据已保存在 Neo4j 中
- 后续版本会支持从数据库恢复

---

## 高级用法

### 使用 Neo4j 浏览器

访问 http://localhost:7474

**登录信息：**
- 用户名：`neo4j`
- 密码：`password`

**常用查询：**

```cypher
// 查看所有人物
MATCH (c:Character)
RETURN c.name, c.importance
ORDER BY c.importance DESC
LIMIT 10

// 查看人物关系网络
MATCH (c1:Character)-[r:KNOWS]->(c2:Character)
RETURN c1, r, c2

// 查看主线事件
MATCH (e:Event)
WHERE e.contribution_score > 0.7
RETURN e.description, e.chapter
ORDER BY e.chapter

// 查看人物参与的事件
MATCH (c:Character {name: '张三'})-[:PARTICIPATES_IN]->(e:Event)
RETURN e.description, e.chapter
ORDER BY e.chapter
```

### 命令行分析

适合开发和测试：

```bash
# 运行完整演示
python scripts/milestone3_demo.py

# 运行基础演示
python scripts/demo_analysis.py
```

### API 调用

可以直接调用 API 进行集成：

```javascript
// 上传文件
POST http://localhost:5000/api/upload
Content-Type: multipart/form-data

// 分析小说
POST http://localhost:5000/api/analyze
Content-Type: application/json
{
  "filepath": "path/to/novel.txt"
}

// 获取人物列表
GET http://localhost:5000/api/novel/{novel_id}/characters

// 获取关系图谱
GET http://localhost:5000/api/novel/{novel_id}/graph
```

完整 API 文档请参考 `backend/api/routes.py`

---

## 技巧和建议

### 1. 小说准备

**最佳实践：**
- 使用规范的章节标题（第一章、第二章...）
- 保持人物名称一致
- 避免过多的别名和称呼
- UTF-8 编码

### 2. 分析结果解读

**人物重要性：**
- > 80%：绝对主角
- 50-80%：主要人物
- 20-50%：重要配角
- < 20%：次要人物

**关系强度：**
- > 70%：非常紧密
- 40-70%：较为紧密
- 20-40%：一般关系
- < 20%：弱关系

**事件重要性：**
- > 80%：关键转折点
- 50-80%：重要事件
- 20-50%：一般事件
- < 20%：次要事件

### 3. 性能优化

- 关闭不需要的浏览器标签页
- 一次只分析一部小说
- 定期清理 Neo4j 数据库
- 使用 SSD 硬盘

---

## 反馈和支持

遇到问题或有建议？

- 📧 GitHub Issues: https://github.com/mirayan-2705024/LikeNovel/issues
- 📖 项目主页: https://github.com/mirayan-2705024/LikeNovel

---

**祝你使用愉快！** 🎉
